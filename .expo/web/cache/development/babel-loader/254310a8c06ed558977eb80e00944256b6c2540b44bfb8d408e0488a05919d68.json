{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport * as SecureStore from 'expo-secure-store';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nvar URL = 'http://192.168.0.111:5000';\nfunction handleLogin(_x, _x2, _x3) {\n  return _handleLogin.apply(this, arguments);\n}\nfunction _handleLogin() {\n  _handleLogin = _asyncToGenerator(function* (username, password, errorHandler) {\n    var request = yield fetch(`${URL}/auth/login`, {\n      method: 'post',\n      headers: {\n        \"Content-type\": 'application/json'\n      },\n      body: JSON.stringify({\n        username: username,\n        password: password\n      })\n    });\n    if (request.status === 200) {\n      var response_json = yield request.json();\n      yield save('access_token', response_json.access_token);\n      yield save('refresh_token', response_json.refresh_token);\n      yield handleSetUser(errorHandler);\n    } else {\n      if (errorHandler !== undefined) {\n        errorHandler();\n      }\n    }\n  });\n  return _handleLogin.apply(this, arguments);\n}\nfunction handleSetUser(_x4) {\n  return _handleSetUser.apply(this, arguments);\n}\nfunction _handleSetUser() {\n  _handleSetUser = _asyncToGenerator(function* (errorHandler) {\n    var access_token = yield getValueFor('access_token');\n    var userRequest = yield fetch(`${URL}/v1/profile`, {\n      headers: {\n        'Content-type': 'application/json',\n        'Authorization': `Bearer ${access_token}`\n      }\n    });\n    if (userRequest.status === 200) {\n      var userJSON = yield userRequest.json();\n      yield setUser(JSON.stringify(userJSON));\n      console.log(userJSON);\n    } else {\n      if (errorHandler !== undefined) {\n        errorHandler();\n      }\n    }\n  });\n  return _handleSetUser.apply(this, arguments);\n}\nfunction save(_x5, _x6) {\n  return _save.apply(this, arguments);\n}\nfunction _save() {\n  _save = _asyncToGenerator(function* (key, value) {\n    yield SecureStore.setItemAsync(key, value);\n  });\n  return _save.apply(this, arguments);\n}\nfunction getValueFor(_x7) {\n  return _getValueFor.apply(this, arguments);\n}\nfunction _getValueFor() {\n  _getValueFor = _asyncToGenerator(function* (key) {\n    var result = yield SecureStore.getItemAsync(key);\n    return result;\n  });\n  return _getValueFor.apply(this, arguments);\n}\nfunction setUser(_x8) {\n  return _setUser.apply(this, arguments);\n}\nfunction _setUser() {\n  _setUser = _asyncToGenerator(function* (userJSON) {\n    yield AsyncStorage.setItem('user', userJSON);\n  });\n  return _setUser.apply(this, arguments);\n}\nfunction getUser() {\n  return _getUser.apply(this, arguments);\n}\nfunction _getUser() {\n  _getUser = _asyncToGenerator(function* () {\n    return yield AsyncStorage.getItem('user');\n  });\n  return _getUser.apply(this, arguments);\n}\nexport { getValueFor, save, setUser, getUser, handleLogin, handleSetUser };","map":{"version":3,"names":["SecureStore","AsyncStorage","URL","handleLogin","_x","_x2","_x3","_handleLogin","apply","arguments","_asyncToGenerator","username","password","errorHandler","request","fetch","method","headers","body","JSON","stringify","status","response_json","json","save","access_token","refresh_token","handleSetUser","undefined","_x4","_handleSetUser","getValueFor","userRequest","userJSON","setUser","console","log","_x5","_x6","_save","key","value","setItemAsync","_x7","_getValueFor","result","getItemAsync","_x8","_setUser","setItem","getUser","_getUser","getItem"],"sources":["/home/wamweru/dod_smart_home/dod_smart_home/application/helpers.js"],"sourcesContent":["import * as SecureStore from 'expo-secure-store'\nimport AsyncStorage from '@react-native-async-storage/async-storage'\n\n\nconst URL = 'http://192.168.0.111:5000'\n\nasync function handleLogin(username, password, errorHandler) {\n  // perform fetch request\n  const request = await fetch(`${URL}/auth/login`, {\n    method: 'post',\n    headers: {\n      \"Content-type\": 'application/json',\n    },\n    body: JSON.stringify({\n      username: username,\n      password: password,\n    })\n  })\n  // if request success save return value\n  if (request.status === 200) {\n    const response_json = await request.json()\n    await save('access_token', response_json.access_token)\n    await save('refresh_token', response_json.refresh_token)\n    // handle user storage\n    await handleSetUser(errorHandler)\n  }\n  else {\n    if (errorHandler !== undefined) {\n      errorHandler()\n    }\n  }\n}\n\nasync function handleSetUser(errorHandler) {\n  const access_token = await getValueFor('access_token')\n  const userRequest = await fetch(`${URL}/v1/profile`, {\n    // method: get,\n    headers: {\n      'Content-type': 'application/json',\n      'Authorization': `Bearer ${access_token}`\n    }\n  })\n  if (userRequest.status === 200) {\n    const userJSON = await userRequest.json()\n    await setUser(JSON.stringify(userJSON))\n    console.log(userJSON)\n  }\n  else {\n    if (errorHandler !== undefined) {\n      errorHandler()\n    }\n  }\n}\n\n\nasync function save(key, value) {\n  await SecureStore.setItemAsync(key, value)\n}\n\nasync function getValueFor(key) {\n  const result = await SecureStore.getItemAsync(key)\n  return result\n}\n\n\nasync function setUser(userJSON) {\n  await AsyncStorage.setItem('user', userJSON)\n}\nasync function getUser() {\n  return await AsyncStorage.getItem('user')\n}\n\nexport {\n  getValueFor,\n  save,\n  setUser,\n  getUser,\n  handleLogin,\n  handleSetUser\n}\n"],"mappings":";AAAA,OAAO,KAAKA,WAAW,MAAM,mBAAmB;AAChD,OAAOC,YAAY,MAAM,2CAA2C;AAGpE,IAAMC,GAAG,GAAG,2BAA2B;AAAA,SAExBC,WAAWA,CAAAC,EAAA,EAAAC,GAAA,EAAAC,GAAA;EAAA,OAAAC,YAAA,CAAAC,KAAA,OAAAC,SAAA;AAAA;AAAA,SAAAF,aAAA;EAAAA,YAAA,GAAAG,iBAAA,CAA1B,WAA2BC,QAAQ,EAAEC,QAAQ,EAAEC,YAAY,EAAE;IAE3D,IAAMC,OAAO,SAASC,KAAK,CAAE,GAAEb,GAAI,aAAY,EAAE;MAC/Cc,MAAM,EAAE,MAAM;MACdC,OAAO,EAAE;QACP,cAAc,EAAE;MAClB,CAAC;MACDC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;QACnBT,QAAQ,EAAEA,QAAQ;QAClBC,QAAQ,EAAEA;MACZ,CAAC;IACH,CAAC,CAAC;IAEF,IAAIE,OAAO,CAACO,MAAM,KAAK,GAAG,EAAE;MAC1B,IAAMC,aAAa,SAASR,OAAO,CAACS,IAAI,CAAC,CAAC;MAC1C,MAAMC,IAAI,CAAC,cAAc,EAAEF,aAAa,CAACG,YAAY,CAAC;MACtD,MAAMD,IAAI,CAAC,eAAe,EAAEF,aAAa,CAACI,aAAa,CAAC;MAExD,MAAMC,aAAa,CAACd,YAAY,CAAC;IACnC,CAAC,MACI;MACH,IAAIA,YAAY,KAAKe,SAAS,EAAE;QAC9Bf,YAAY,CAAC,CAAC;MAChB;IACF;EACF,CAAC;EAAA,OAAAN,YAAA,CAAAC,KAAA,OAAAC,SAAA;AAAA;AAAA,SAEckB,aAAaA,CAAAE,GAAA;EAAA,OAAAC,cAAA,CAAAtB,KAAA,OAAAC,SAAA;AAAA;AAAA,SAAAqB,eAAA;EAAAA,cAAA,GAAApB,iBAAA,CAA5B,WAA6BG,YAAY,EAAE;IACzC,IAAMY,YAAY,SAASM,WAAW,CAAC,cAAc,CAAC;IACtD,IAAMC,WAAW,SAASjB,KAAK,CAAE,GAAEb,GAAI,aAAY,EAAE;MAEnDe,OAAO,EAAE;QACP,cAAc,EAAE,kBAAkB;QAClC,eAAe,EAAG,UAASQ,YAAa;MAC1C;IACF,CAAC,CAAC;IACF,IAAIO,WAAW,CAACX,MAAM,KAAK,GAAG,EAAE;MAC9B,IAAMY,QAAQ,SAASD,WAAW,CAACT,IAAI,CAAC,CAAC;MACzC,MAAMW,OAAO,CAACf,IAAI,CAACC,SAAS,CAACa,QAAQ,CAAC,CAAC;MACvCE,OAAO,CAACC,GAAG,CAACH,QAAQ,CAAC;IACvB,CAAC,MACI;MACH,IAAIpB,YAAY,KAAKe,SAAS,EAAE;QAC9Bf,YAAY,CAAC,CAAC;MAChB;IACF;EACF,CAAC;EAAA,OAAAiB,cAAA,CAAAtB,KAAA,OAAAC,SAAA;AAAA;AAAA,SAGce,IAAIA,CAAAa,GAAA,EAAAC,GAAA;EAAA,OAAAC,KAAA,CAAA/B,KAAA,OAAAC,SAAA;AAAA;AAAA,SAAA8B,MAAA;EAAAA,KAAA,GAAA7B,iBAAA,CAAnB,WAAoB8B,GAAG,EAAEC,KAAK,EAAE;IAC9B,MAAMzC,WAAW,CAAC0C,YAAY,CAACF,GAAG,EAAEC,KAAK,CAAC;EAC5C,CAAC;EAAA,OAAAF,KAAA,CAAA/B,KAAA,OAAAC,SAAA;AAAA;AAAA,SAEcsB,WAAWA,CAAAY,GAAA;EAAA,OAAAC,YAAA,CAAApC,KAAA,OAAAC,SAAA;AAAA;AAAA,SAAAmC,aAAA;EAAAA,YAAA,GAAAlC,iBAAA,CAA1B,WAA2B8B,GAAG,EAAE;IAC9B,IAAMK,MAAM,SAAS7C,WAAW,CAAC8C,YAAY,CAACN,GAAG,CAAC;IAClD,OAAOK,MAAM;EACf,CAAC;EAAA,OAAAD,YAAA,CAAApC,KAAA,OAAAC,SAAA;AAAA;AAAA,SAGcyB,OAAOA,CAAAa,GAAA;EAAA,OAAAC,QAAA,CAAAxC,KAAA,OAAAC,SAAA;AAAA;AAAA,SAAAuC,SAAA;EAAAA,QAAA,GAAAtC,iBAAA,CAAtB,WAAuBuB,QAAQ,EAAE;IAC/B,MAAMhC,YAAY,CAACgD,OAAO,CAAC,MAAM,EAAEhB,QAAQ,CAAC;EAC9C,CAAC;EAAA,OAAAe,QAAA,CAAAxC,KAAA,OAAAC,SAAA;AAAA;AAAA,SACcyC,OAAOA,CAAA;EAAA,OAAAC,QAAA,CAAA3C,KAAA,OAAAC,SAAA;AAAA;AAAA,SAAA0C,SAAA;EAAAA,QAAA,GAAAzC,iBAAA,CAAtB,aAAyB;IACvB,aAAaT,YAAY,CAACmD,OAAO,CAAC,MAAM,CAAC;EAC3C,CAAC;EAAA,OAAAD,QAAA,CAAA3C,KAAA,OAAAC,SAAA;AAAA;AAED,SACEsB,WAAW,EACXP,IAAI,EACJU,OAAO,EACPgB,OAAO,EACP/C,WAAW,EACXwB,aAAa"},"metadata":{},"sourceType":"module","externalDependencies":[]}